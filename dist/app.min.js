angular.module("app", [ "ui.router", "app.template" ]);

(function() {
    angular.module("app").controller("case3Controller", Case3Controller);
    Case3Controller.$inject = [ "$scope", "employees" ];
    function Case3Controller($scope, employees) {
        var apeldoornEmployees = employees, totalAge;
        $scope.employees = apeldoornEmployees;
        $scope.totalAge = totalAge;
    }
})();

(function() {
    angular.module("app").factory("employeeService", EmployeeService);
    EmployeeService.$inject = [ "$http" ];
    function EmployeeService($http) {
        "use strict";
        return {
            get: getEmployees
        };
        function getEmployees() {
            return $http.get("./data/employees.json").then(function(response) {
                return response.data;
            });
        }
    }
})();

(function() {
    angular.module("app").config(routes);
    routes.$inject = [ "$stateProvider", "$urlRouterProvider" ];
    function routes($stateProvider, $urlRouterProvider) {
        $urlRouterProvider.otherwise("/");
        $stateProvider.state("main", {
            url: "/",
            templateUrl: "main/main.html",
            controller: "mainController as mainCtrl"
        }).state("case3", {
            url: "/case3",
            templateUrl: "case3/case3.html",
            controller: "case3Controller as case1Ctrl",
            resolve: {
                employees: [ "employeeService", function(employeeService) {
                    return employeeService.get();
                } ]
            }
        });
    }
})();

(function() {
    angular.module("app").controller("mainController", MainController);
    MainController.$inject = [];
    function MainController() {}
})();

(function() {
    angular.module("app").controller("prettyJsonController", PrettyJsonController);
    PrettyJsonController.$inject = [ "$scope", "$sce" ];
    function PrettyJsonController($scope, $sce) {
        $scope.prettyJson = $sce.trustAsHtml(prettyJson($scope.data));
        function prettyJson(json) {
            var jsonRegex = /("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g;
            if (typeof json !== "string") {
                json = JSON.stringify(json, undefined, 2);
            }
            json = json.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            return json.replace(jsonRegex, function(match) {
                var cls = "number";
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = "key";
                    } else {
                        cls = "string";
                    }
                } else if (/true|false/.test(match)) {
                    cls = "boolean";
                } else if (/null/.test(match)) {
                    cls = "null";
                }
                return '<span class="' + cls + '">' + match + "</span>";
            });
        }
    }
})();

(function() {
    angular.module("app").directive("prettyJson", PrettyJsonDirective);
    function PrettyJsonDirective() {
        return {
            restrict: "E",
            templateUrl: "prettyJson/prettyJson.html",
            scope: {
                data: "=",
                name: "@"
            },
            controller: "prettyJsonController",
            controllerAs: "prettyJson"
        };
    }
})();

angular.module("app.template", []).run([ "$templateCache", function($templateCache) {
    $templateCache.put("case3/case3.html", "<h2>Case 3: Apeldoorn medewerkers</h2>\n" + "<ul>\n" + '    <li class="employee" ng-repeat="employee in employees">\n' + "        {{employee.firstname}} {{employee.lastname}} ({{employee.job}}, {{employee.location}})\n" + "    </li>\n" + "</ul>\n" + "\n" + "Total age: {{totalAge}}\n" + "\n" + '<pretty-json name="employees" data="employees"></pretty-json>\n' + "");
    $templateCache.put("main/main.html", "<h1>Welkom!</h1>\n" + "\n" + "Kies een case om te beginnen.");
    $templateCache.put("prettyJson/prettyJson.html", "<section>\n" + "    <h4>Raw data ({{name}}):</h4>\n" + '    <pre ng-bind-html="prettyJson"></pre>\n' + "</section>\n" + "\n" + "");
} ]);
